/* ======================================================
   Web Applications Using Servlets and JSP
   Parts (a), (b), (c)
   ====================================================== */

/* =======================
   PART (a) – LOGIN MODULE
   ======================= */

/* ---------- login.html ---------- */
<!--
<!DOCTYPE html>
<html>
<head>
    <title>User Login</title>
</head>
<body>
    <h2>Login Page</h2>
    <form action="LoginServlet" method="post">
        Username: <input type="text" name="username" required><br><br>
        Password: <input type="password" name="password" required><br><br>
        <input type="submit" value="Login">
    </form>
</body>
</html>
-->

/* ---------- LoginServlet.java ---------- */
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        response.setContentType("text/html");
        PrintWriter out = response.getWriter();

        String user = request.getParameter("username");
        String pass = request.getParameter("password");

        // Hardcoded login validation
        if (user.equals("admin") && pass.equals("12345")) {
            out.println("<h2>Welcome, " + user + "!</h2>");
        } else {
            out.println("<h3 style='color:red;'>Invalid username or password</h3>");
            out.println("<a href='login.html'>Try Again</a>");
        }
    }
}

/* ==============================
   PART (b) – EMPLOYEE MANAGEMENT
   ============================== */

/* ---------- employees.html ---------- */
<!--
<!DOCTYPE html>
<html>
<head>
    <title>Employee Records</title>
</head>
<body>
    <h2>View Employee Records</h2>
    <form action="EmployeeServlet" method="get">
        <input type="submit" value="Show All Employees">
    </form>

    <h3>Search Employee by ID</h3>
    <form action="EmployeeServlet" method="get">
        Enter EmpID: <input type="text" name="empid">
        <input type="submit" value="Search">
    </form>
</body>
</html>
-->

/* ---------- EmployeeServlet.java ---------- */
import java.io.*;
import java.sql.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class EmployeeServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        response.setContentType("text/html");
        PrintWriter out = response.getWriter();
        String empid = request.getParameter("empid");

        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection con = DriverManager.getConnection(
                    "jdbc:mysql://localhost:3306/company", "root", "password");

            String query;
            if (empid != null && !empid.isEmpty()) {
                query = "SELECT * FROM Employee WHERE EmpID=" + empid;
            } else {
                query = "SELECT * FROM Employee";
            }

            Statement stmt = con.createStatement();
            ResultSet rs = stmt.executeQuery(query);

            out.println("<h2>Employee Details</h2>");
            out.println("<table border='1'><tr><th>EmpID</th><th>Name</th><th>Salary</th></tr>");

            boolean found = false;
            while (rs.next()) {
                found = true;
                out.println("<tr><td>" + rs.getInt("EmpID") + "</td><td>"
                        + rs.getString("Name") + "</td><td>"
                        + rs.getDouble("Salary") + "</td></tr>");
            }
            out.println("</table>");
            if (!found) {
                out.println("<p style='color:red;'>No record found!</p>");
            }
            con.close();
        } catch (Exception e) {
            out.println("<p style='color:red;'>Error: " + e.getMessage() + "</p>");
        }
    }
}

/* ======================================
   PART (c) – STUDENT ATTENDANCE PORTAL
   ====================================== */

/* ---------- attendance.jsp ---------- */
<!--
<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<html>
<head>
    <title>Student Attendance Portal</title>
</head>
<body>
    <h2>Mark Attendance</h2>
    <form action="AttendanceServlet" method="post">
        Student ID: <input type="text" name="studentID" required><br><br>
        Date: <input type="date" name="date" required><br><br>
        Status: 
        <select name="status">
            <option value="Present">Present</option>
            <option value="Absent">Absent</option>
        </select><br><br>
        <input type="submit" value="Submit Attendance">
    </form>
</body>
</html>
-->

/* ---------- AttendanceServlet.java ---------- */
import java.io.*;
import java.sql.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class AttendanceServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        response.setContentType("text/html");
        PrintWriter out = response.getWriter();

        String studentID = request.getParameter("studentID");
        String date = request.getParameter("date");
        String status = request.getParameter("status");

        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection con = DriverManager.getConnection(
                    "jdbc:mysql://localhost:3306/school", "root", "password");

            PreparedStatement ps = con.prepareStatement("INSERT INTO Attendance VALUES (?, ?, ?)");
            ps.setInt(1, Integer.parseInt(studentID));
            ps.setString(2, date);
            ps.setString(3, status);

            int i = ps.executeUpdate();
            if (i > 0)
                response.sendRedirect("success.jsp");
            else
                out.println("<h3 style='color:red;'>Failed to mark attendance!</h3>");
            con.close();
        } catch (Exception e) {
            out.println("<p style='color:red;'>Error: " + e.getMessage() + "</p>");
        }
    }
}

/* ---------- success.jsp ---------- */
<!--
<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<html>
<head><title>Success</title></head>
<body>
    <h2>Attendance Saved Successfully!</h2>
    <a href="attendance.jsp">Go Back</a>
</body>
</html>
-->

/* =====================================
   WEB DEPLOYMENT DESCRIPTOR (web.xml)
   ===================================== */
<!--
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <servlet>
        <servlet-name>LoginServlet</servlet-name>
        <servlet-class>LoginServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>LoginServlet</servlet-name>
        <url-pattern>/LoginServlet</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>EmployeeServlet</servlet-name>
        <servlet-class>EmployeeServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>EmployeeServlet</servlet-name>
        <url-pattern>/EmployeeServlet</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>AttendanceServlet</servlet-name>
        <servlet-class>AttendanceServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>AttendanceServlet</servlet-name>
        <url-pattern>/AttendanceServlet</url-pattern>
    </servlet-mapping>

</web-app>
-->
